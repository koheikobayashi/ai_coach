app:
  description: "æ˜¨æ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’èã„ã¦ã€è¤’ã‚ã¦ã€æ¬¡ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ææ¡ˆã™ã‚‹AIã‚³ãƒ¼ãƒ"
  icon: "ğŸ‹ï¸"
  icon_background: "#E0F2FE"
  mode: advanced-chat
  name: "AIã‚³ãƒ¼ãƒ"
  use_icon_as_answer_icon: false

dependencies: []
kind: app
version: 0.5.0

workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions: [".JPG", ".JPEG", ".PNG", ".GIF", ".WEBP", ".SVG"]
      allowed_file_types: ["image"]
      allowed_file_upload_methods: ["local_file", "remote_url"]
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_batch_limit: 10
        image_file_size_limit: 10
        single_chunk_attachment_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods: ["local_file", "remote_url"]
      number_limits: 3

    opening_statement: "ãŠã¯ã‚ˆã†ï¼æ˜¨æ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ä½•ã‚’ã‚„ã£ãŸï¼Ÿï¼ˆä¼‘é¤Šæ—¥ã§ã‚‚OKï¼‰"
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ""
      voice: ""

  graph:
    edges:
      - data:
          isInIteration: false
          isInLoop: false
          sourceType: start
          targetType: parameter-extractor
        id: start-source-extract-target
        source: "start"
        sourceHandle: source
        target: "extract"
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: parameter-extractor
          targetType: code
        id: extract-source-build_payload-target
        source: "extract"
        sourceHandle: source
        target: "build_payload"
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: code
          targetType: http-request
        id: build_payload-source-gas_post-target
        source: "build_payload"
        sourceHandle: source
        target: "gas_post"
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: http-request
          targetType: llm
        id: gas_post-source-coach_llm-target
        source: "gas_post"
        sourceHandle: source
        target: "coach_llm"
        targetHandle: target
        type: custom
        zIndex: 0

      - data:
          isInIteration: false
          isInLoop: false
          sourceType: llm
          targetType: answer
        id: coach_llm-source-answer-target
        source: "coach_llm"
        sourceHandle: source
        target: "answer"
        targetHandle: target
        type: custom
        zIndex: 0

    nodes:
      - data:
          desc: ""
          selected: false
          title: "é–‹å§‹"
          type: start
          variables: []
        height: 54
        id: "start"
        position: { x: 80, y: 282 }
        positionAbsolute: { x: 80, y: 282 }
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244

      - data:
          desc: ""
          instruction: |
            æ¬¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¨€ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹ï¼‰ã‹ã‚‰ã€å¯èƒ½ãªç¯„å›²ã§æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
            - ä¼‘é¤Šæ—¥/ã‚ªãƒ•ã®å ´åˆã¯ is_rest=true ã«ã—ã¦ãã ã•ã„ã€‚
            - æ•°å€¤ãŒç„¡ã„å ´åˆã¯ç„¡ç†ã«åŸ‹ã‚ãšã€æ¬ æã§OKã§ã™ã€‚
          model:
            completion_params:
              temperature: 0.2
            mode: chat
            name: gpt-4o-mini
            provider: openai
          parameters:
            - description: "è¡Œã£ãŸç¨®ç›®ã®ãƒªã‚¹ãƒˆï¼ˆä¾‹: ãƒ©ãƒ³5km, ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ 60kgÃ—5Ã—3 ãªã©ï¼‰"
              name: workout_items
              options: []
              required: false
              type: array[string]
            - description: "åˆè¨ˆæ™‚é–“ï¼ˆåˆ†ï¼‰"
              name: duration_min
              options: []
              required: false
              type: number
            - description: "ãã¤ã•ï¼ˆlow/medium/highï¼‰"
              name: intensity
              options: []
              required: false
              type: string
            - description: "ä¸»è¦³çš„ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼ˆgood/normal/tired ãªã©ï¼‰"
              name: condition
              options: []
              required: false
              type: string
            - description: "ä¼‘é¤Šæ—¥ãªã‚‰ true"
              name: is_rest
              options: []
              required: false
              type: boolean
          query:
            - sys
            - query
          reasoning_mode: prompt
          selected: false
          title: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼æŠ½å‡º"
          type: parameter-extractor
          variables: []
          vision:
            enabled: false
        height: 98
        id: "extract"
        position: { x: 384, y: 282 }
        positionAbsolute: { x: 384, y: 282 }
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244

      - data:
          code_language: python3
          code: |
            def main(user_id, workout_items, duration_min, intensity, condition, is_rest) -> dict:
                from datetime import datetime, timedelta
                try:
                    from zoneinfo import ZoneInfo
                    tz = ZoneInfo("Asia/Tokyo")
                    now = datetime.now(tz)
                except Exception:
                    now = datetime.utcnow()

                date = (now - timedelta(days=1)).date().isoformat()

                items = workout_items or []
                if is_rest:
                    exercise = "rest"
                elif items:
                    exercise = " / ".join([str(x) for x in items])
                else:
                    exercise = "unknown"

                memo_parts = []
                if duration_min is not None:
                    memo_parts.append(f"duration_min={duration_min}")
                if intensity:
                    memo_parts.append(f"intensity={intensity}")
                if condition:
                    memo_parts.append(f"condition={condition}")
                memo = ", ".join(memo_parts)

                return {
                    "user": user_id or "unknown",
                    "date": date,
                    "exercise": exercise,
                    "sets": "",
                    "weight": "",
                    "reps": "",
                    "memo": memo,
                }
          desc: ""
          outputs:
            user: { children: null, type: string }
            date: { children: null, type: string }
            exercise: { children: null, type: string }
            sets: { children: null, type: string }
            weight: { children: null, type: string }
            reps: { children: null, type: string }
            memo: { children: null, type: string }
          selected: false
          title: "GASé€ä¿¡ç”¨payloadä½œæˆ"
          type: code
          variables:
            - value_selector: [sys, user_id]
              variable: user_id
            - value_selector: [extract, workout_items]
              variable: workout_items
            - value_selector: [extract, duration_min]
              variable: duration_min
            - value_selector: [extract, intensity]
              variable: intensity
            - value_selector: [extract, condition]
              variable: condition
            - value_selector: [extract, is_rest]
              variable: is_rest
        height: 54
        id: "build_payload"
        position: { x: 684, y: 282 }
        positionAbsolute: { x: 684, y: 282 }
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244

      - data:
          authorization:
            config: null
            type: no-auth
          body:
            type: json
            data:
              - id: key-value-1
                key: ""
                type: text
                value: |
                  {
                    "user": "{{#build_payload.user#}}",
                    "date": "{{#build_payload.date#}}",
                    "exercise": "{{#build_payload.exercise#}}",
                    "sets": "{{#build_payload.sets#}}",
                    "weight": "{{#build_payload.weight#}}",
                    "reps": "{{#build_payload.reps#}}",
                    "memo": "{{#build_payload.memo#}}"
                  }
          desc: ""
          headers: |
            Content-Type: application/json
          method: post
          params: ""
          retry_config:
            max_retries: 2
            retry_enabled: true
            retry_interval: 200
          ssl_verify: true
          timeout:
            max_connect_timeout: 0
            max_read_timeout: 0
            max_write_timeout: 0
          title: "GASã«è¨˜éŒ²"
          type: http-request
          url: "REPLACE_ME_WITH_YOUR_GAS_WEBAPP_URL"
        height: 126
        id: "gas_post"
        position: { x: 984, y: 282 }
        positionAbsolute: { x: 984, y: 282 }
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244

      - data:
          context:
            enabled: false
            variable_selector: []
          desc: ""
          model:
            completion_params:
              temperature: 0.7
            mode: chat
            name: gpt-4o-mini
            provider: openai
          prompt_template:
            - id: sys
              role: system
              text: |
                ã‚ãªãŸã¯å„ªç§€ã§ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¹ãƒãƒ¼ãƒ„AIã‚³ãƒ¼ãƒã§ã™ã€‚
                ç›®çš„ã¯ã€Œç¶™ç¶šã‚’ä¿ƒã™ã“ã¨ã€ã¨ã€Œå®‰å…¨ã§ç¾å®Ÿçš„ãªæ¬¡ã®ä¸€æ­©ã‚’ææ¡ˆã™ã‚‹ã“ã¨ã€ã€‚
                è¿”ç­”ã¯çŸ­ã‚ã«ã€ä»¥ä¸‹ã®é †ã§å‡ºã—ã¦ãã ã•ã„ï¼š
                1) ã¾ãšè¤’ã‚ã‚‹ï¼ˆå…·ä½“çš„ã«ï¼‰
                2) ã²ã¨ã“ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆå®‰å…¨é¢/è² è·ãƒãƒ©ãƒ³ã‚¹ï¼‰
                3) æ˜æ—¥ã®ææ¡ˆã‚’2ã€œ3å€‹ï¼ˆæ‰€è¦æ™‚é–“ã‚‚æ·»ãˆã‚‹ï¼‰
                4) æœ€å¾Œã«è³ªå•ã‚’1ã¤
            - id: user
              role: user
              text: |
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¨€: {{#sys.query#}}
                æŠ½å‡ºçµæœ:
                - workout_items: {{#extract.workout_items#}}
                - duration_min: {{#extract.duration_min#}}
                - intensity: {{#extract.intensity#}}
                - condition: {{#extract.condition#}}
                - is_rest: {{#extract.is_rest#}}
          selected: false
          title: "AIã‚³ãƒ¼ãƒè¿”ä¿¡"
          type: llm
          variables: []
          vision:
            enabled: false
        height: 98
        id: "coach_llm"
        position: { x: 1284, y: 282 }
        positionAbsolute: { x: 1284, y: 282 }
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244

      - data:
          answer: "{{#coach_llm.text#}}"
          desc: ""
          selected: false
          title: "è¿”ä¿¡"
          type: answer
          variables: []
        height: 104
        id: "answer"
        position: { x: 1584, y: 282 }
        positionAbsolute: { x: 1584, y: 282 }
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244

    viewport:
      x: 0
      y: 0
      zoom: 0.8
