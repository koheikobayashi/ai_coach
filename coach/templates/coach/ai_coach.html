{% extends "coach/base.html" %}
{% load static %}

{% block content %}
<div class="ai-coach-page">
  <div class="ai-coach-image">
    <img src="{% static 'images/coach.png' %}" alt="AI Coach" onerror="this.style.display='none'">
  </div>

  <div class="ai-coach-bubble">
    <div class="speech-bubble ai-coach-speech" id="coach-advice">
      <span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>
    </div>
  </div>
</div>

<script>
(function() {
  const adviceEl = document.getElementById('coach-advice');

  fetch('{% url "ai_coach_api" %}', {
    headers: { 'X-CSRFToken': '{{ csrf_token }}' },
  })
    .then(function(resp) { return resp.json(); })
    .then(function(data) {
      if (data.advice) {
        adviceEl.innerHTML = data.advice.replace(/\n/g, '<br>');
      } else {
        adviceEl.textContent = data.error || 'アドバイスを取得できませんでした。';
      }
    })
    .catch(function() {
      adviceEl.textContent = '通信エラーが発生しました。もう一度お試しください。';
    });
})();
</script>
{% endblock %}
